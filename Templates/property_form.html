<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>{{ action }} Property – IndiaPropertyHub</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/property_form.css') }}">
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="container header-inner">
      <h1 class="logo"><a href="{{ url_for('index') }}">IndiaPropertyHub</a></h1>
      <nav class="site-nav">
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('properties') }}">Manage</a>
        <a href="{{ url_for('logout') }}">Logout</a>
      </nav>
    </div>
  </header>

  <main class="container form-page">
    <div class="form-card">
      <h2>{{ action }} Property</h2>

      {% with msgs = get_flashed_messages(with_categories=true) %}
        {% if msgs %}
          <ul class="flashes">
            {% for cat, msg in msgs %}
              <li class="{{ cat }}">{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <form method="post" enctype="multipart/form-data">
        <!-- OWNER SELECT -->
        <div class="field">
          <select id="ownerId" name="ownerId" required>
            <option value="" disabled {% if not property %}selected{% endif %}>Choose owner</option>
            {% for u in users %}
              <option value="{{ u.userId }}"
                {% if property and property.ownerId==u.userId %}selected{% endif %}>
                {{ u.username }}
              </option>
            {% endfor %}
          </select>
          <label for="ownerId">Owner</label>
        </div>

        <!-- ADDRESS -->
        <div class="field">
          <input id="address" name="address" type="text" required
                 value="{{ property.address if property }}" placeholder=" ">
          <label for="address">Address</label>
        </div>

        <!-- PRICE & AREA -->
        <div class="field two-col">
          <div>
            <input id="price" name="price" type="number" step="0.01" required
                   value="{{ property.price if property }}" placeholder=" ">
            <label for="price">Price (₹)</label>
          </div>
          <div>
            <input id="carpetArea" name="carpetArea" type="number" required
                   value="{{ property.carpetArea if property }}" placeholder=" ">
            <label for="carpetArea">Carpet Area (sq ft)</label>
          </div>
        </div>

        <!-- TYPE & CITY -->
        <div class="field two-col">
          <div>
            <select id="typeId" name="typeId" required>
              <option value="" disabled {% if not property %}selected{% endif %}>Choose type</option>
              {% for t in types %}
                <option value="{{ t.typeId }}"
                  {% if property and property.typeId==t.typeId %}selected{% endif %}>
                  {{ t.typeName }}
                </option>
              {% endfor %}
            </select>
            <label for="typeId">Property Type</label>
          </div>
          <div>
            <select id="city" name="city" required>
              <option value="" disabled {% if not property %}selected{% endif %}>Choose city</option>
              {% set cities = [
                'Mumbai','Delhi','Bengaluru','Kolkata','Chennai',
                'Ahmedabad','Hyderabad','Pune','Surat','Jaipur',
                'Lucknow','Kanpur','Nagpur','Indore','Thane',
                'Bhopal','Visakhapatnam','Pimpri-Chinchwad','Patna','Vadodara'
              ] %}
              {% for c in cities %}
                <option value="{{ c }}" {% if property and property.city==c %}selected{% endif %}>
                  {{ c }}
                </option>
              {% endfor %}
            </select>
            <label for="city">City</label>
          </div>
        </div>

        <!-- RERA -->
        <div class="field checkbox-field">
          <input type="checkbox" id="reraRegistered" name="reraRegistered"
            {% if property and property.reraRegistered %}checked{% endif %}>
          <label for="reraRegistered">RERA Registered</label>
        </div>

        <!-- EXISTING IMAGES -->
        {% if property_images %}
          <fieldset class="existing-images">
            <legend>Existing Images</legend>
            <div class="thumbs">
              {% for img in property_images %}
                <div class="thumb">
                  <img src="{{ img.imageURL }}" alt="Image {{ loop.index }}">
                  <label>
                    <input type="checkbox" name="delete_images" value="{{ img.imageId }}">
                    Delete
                  </label>
                </div>
              {% endfor %}
            </div>
          </fieldset>
        {% endif %}

        <!-- UPLOAD NEW -->
        <fieldset class="upload-images">
          <legend>Upload New Images</legend>
          <input type="file" id="images" name="images" multiple accept="image/*">
        </fieldset>

        <!-- SUBMIT -->
        <button type="submit" class="btn-submit">{{ action }} Property</button>
      </form>
    </div>
  </main>

</body>
</html>